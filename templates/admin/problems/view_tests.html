{% extends "admin/base_site.html" %}
{% block content %}
<h2>📄 {{ problem.code }} – {{ problem.title }}</h2>
<p><b>Tổng số test:</b> {{ testcases|length }}</p>
<hr>

<table class="table table-striped">
  <thead>
    <tr><th>#</th><th>Input</th><th>Output</th><th>Xoá</th></tr>
  </thead>
  <tbody>
    {% for t in testcases %}
    <tr id="row-{{ t.id }}">
      <td>{{ forloop.counter }}</td>
      <td><pre style="white-space:pre-wrap;max-height:200px;overflow:auto;">{{ t.input_data|truncatechars:400 }}</pre></td>
      <td><pre style="white-space:pre-wrap;max-height:200px;overflow:auto;">{{ t.expected_output|truncatechars:400 }}</pre></td>
      <td><button class="btn btn-danger btn-sm" onclick="deleteTest({{ t.id }})">🗑 Xoá</button></td>
    </tr>
    {% empty %}
    <tr><td colspan="4">⚠️ Chưa có test case nào</td></tr>
    {% endfor %}
  </tbody>
</table>

<script>
function deleteTest(testId) {
  if (!confirm("Bạn có chắc muốn xoá test này?")) return;
  fetch(`/admin/problems/problem/{{ problem.id }}/delete_test/${testId}/`, {
    method: "POST",
    headers: {"X-CSRFToken": "{{ csrf_token }}"}
  })
  .then(res => res.json())
  .then(data => {
    if (data.status === "ok") {
      document.getElementById(`row-${testId}`).remove();
    } else {
      alert("❌ " + (data.message || "Lỗi khi xoá test."));
    }
  })
  .catch(err => alert("⚠️ Lỗi mạng: " + err));
}
</script>
{% endblock %}
