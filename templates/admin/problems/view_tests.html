{% extends "admin/base_site.html" %}
{% block content %}
<div style="max-width:900px;margin:auto;font-family:'Segoe UI',sans-serif;">
  <h2>üìÑ {{ problem.code }} ‚Äì {{ problem.title }}</h2>
  <p><b>T·ªïng s·ªë test:</b> <span id="test-count">{{ testcases|length }}</span></p>
  <hr>

  <table class="table" style="width:100%;border-collapse:collapse;">
    <thead style="background:#f1f1f1;">
      <tr>
        <th style="width:40px;">#</th>
        <th>Input</th>
        <th>Output</th>
        <th style="width:80px;text-align:center;">Xo√°</th>
      </tr>
    </thead>
    <tbody id="test-table">
      {% for t in testcases %}
      <tr id="test-{{ t.id }}" style="border-bottom:1px solid #ddd;">
        <td>{{ forloop.counter }}</td>
        <td><pre style="white-space:pre-wrap;max-height:150px;overflow:auto;">{{ t.input_data|truncatechars:400 }}</pre></td>
        <td><pre style="white-space:pre-wrap;max-height:150px;overflow:auto;">{{ t.expected_output|truncatechars:400 }}</pre></td>
        <td style="text-align:center;">
          <button class="delete-btn" data-id="{{ t.id }}"
            style="background:#f44336;color:white;border:none;padding:4px 8px;border-radius:4px;cursor:pointer;">üóë</button>
        </td>
      </tr>
      {% empty %}
      <tr><td colspan="4" style="text-align:center;color:gray;">‚ö†Ô∏è Ch∆∞a c√≥ test case n√†o</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  document.querySelectorAll(".delete-btn").forEach(btn => {
    btn.addEventListener("click", async e => {
      const id = btn.dataset.id;
      if (!confirm("B·∫°n c√≥ ch·∫Øc mu·ªën xo√° test #" + id + " kh√¥ng?")) return;
      try {
        const res = await fetch(`/admin/problems/delete_test/${id}/`, {
          method: "DELETE",
          headers: { "X-CSRFToken": document.querySelector('[name=csrfmiddlewaretoken]')?.value || "" }
        });
        if (res.ok) {
          document.getElementById("test-" + id)?.remove();
          const c = document.getElementById("test-count");
          c.textContent = parseInt(c.textContent) - 1;
        } else {
          alert("‚ùå L·ªói khi xo√° test.");
        }
      } catch(err) {
        console.error(err);
        alert("‚ùå Kh√¥ng th·ªÉ k·∫øt n·ªëi t·ªõi server.");
      }
    });
  });
});
</script>
{% endblock %}
