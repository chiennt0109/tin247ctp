{% extends "admin/base_site.html" %}
{% load static %}

{% block content %}
<div class="container">
  <h2>{{ original.code }} ‚Äì {{ original.title }}</h2>

  <!-- Form ch√≠nh -->
  <form method="post" enctype="multipart/form-data" novalidate>
    {% csrf_token %}
    {{ adminform.form.as_p }}
    <div class="submit-row">
      <input type="submit" value="üíæ L∆∞u thay ƒë·ªïi" class="default">
    </div>
  </form>

  <!-- Link xem test -->
  <hr>
    <h3>üëÅ Ki·ªÉm tra test case</h3>
  {% if original and original.id %}
    <p>
      <a href="{% url 'admin:view_tests' original.id %}" target="_blank" class="button">
        M·ªü danh s√°ch test trong tab m·ªõi
      </a>
    </p>
  {% else %}
    <p style="color:gray;">üí° H√£y l∆∞u b√†i to√°n tr∆∞·ªõc khi xem test case.</p>
  {% endif %}


  <!-- Upload ZIP -->
  {% if show_upload_button %}
  <hr>
  <h3>üì¶ Upload ZIP Test Cases</h3>
  <form action="{% url 'admin:upload_tests' original.id %}" method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <input type="file" name="zip_file" accept=".zip" required style="margin-bottom:10px;">
    <button type="submit" class="default btn btn-success">‚¨ÜÔ∏è Upload v√† Import</button>
  </form>
  {% endif %}
</div>

<!-- SimpleMDE -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.css">
<script src="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function() {
  const textarea = document.querySelector("#id_statement");
  if (textarea) {
    new SimpleMDE({
      element: textarea,
      spellChecker: false,
      autosave: { enabled: true, delay: 1500, uniqueId: "problem_statement" },
      renderingConfig: { singleLineBreaks: false, codeSyntaxHighlighting: true },
      toolbar: ["bold","italic","heading","|","quote","unordered-list","ordered-list","|",
                "link","image","table","code","|","preview","side-by-side","fullscreen","|","guide"],
      placeholder: "‚úèÔ∏è Nh·∫≠p n·ªôi dung b√†i to√°n b·∫±ng Markdown..."
    });
  }
});
</script>

<style>
.container{max-width:900px;margin:auto;font-family:sans-serif;}
a.button{
  display:inline-block;
  background:#3c8dbc;
  color:white;
  padding:6px 12px;
  border-radius:6px;
  text-decoration:none;
}
a.button:hover{background:#337ab7;}
</style>
{% endblock %}
