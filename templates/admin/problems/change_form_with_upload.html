{% extends "admin/base_site.html" %}
{% load static %}

{% block content %}
<div class="container">
  <h2>{{ original.code }} â€“ {{ original.title }}</h2>

  <!-- === FORM CHÃNH === -->
  <form method="post" enctype="multipart/form-data" novalidate>
    {% csrf_token %}
    {{ adminform.form.as_p }}

    <div class="submit-row">
      <button type="submit" class="default">ğŸ’¾ LÆ°u thay Ä‘á»•i</button>
    </div>
  </form>

  <hr>
  <h3>ğŸ¤– AI Há»— trá»£ nháº­p liá»‡u</h3>
  <div class="ai-buttons">
    <button class="button" onclick="aiGenerateStatement()">âœ¨ Táº¡o Ä‘á» bÃ i</button>
    <button class="button" onclick="aiFixLatex()">ğŸ§  Sá»­a LaTeX</button>
    <button class="button" onclick="aiAutoTag()">ğŸ·ï¸ Gá»£i Ã½ Tags + Code + Difficulty</button>
  </div>

  <p id="aiResult" style="margin-top:10px;"></p>

  <hr>
  <h3>ğŸ‘ Test Cases</h3>
  {% if original and original.id %}
    <a href="{% url 'admin:view_tests' original.id %}"
       target="_blank"
       class="button">ğŸ‘ Má»Ÿ danh sÃ¡ch test</a>
  {% else %}
    <p style="color:gray;">ğŸ’¡ LÆ°u bÃ i toÃ¡n trÆ°á»›c Ä‘á»ƒ xem test</p>
  {% endif %}

  {% if original and original.id %}
  <hr>
  <h3>ğŸ“¦ Upload ZIP Test Cases</h3>
  <p style="margin-bottom:8px;">
    Há»— trá»£:
    <code>folder/test01.in, test01.out</code> hoáº·c
    <code>problem/test01/problem.inp, problem.out</code>
  </p>

  <!-- === FORM UPLOAD RIÃŠNG BIá»†T === -->
  <form action="{% url 'admin:upload_tests' original.id %}"
        method="post"
        enctype="multipart/form-data">
      {% csrf_token %}
      <input type="file" name="zip_file" accept=".zip" required style="margin-bottom:10px;">
      <button type="submit" class="default btn btn-success">â¬†ï¸ Upload & Import</button>
  </form>
  {% endif %}
</div>

<!-- Scripts -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.css">
<script src="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const textarea = document.querySelector("#id_statement");
  if (textarea) {
    new SimpleMDE({
      element: textarea,
      spellChecker: false,
      autosave: {
        enabled: true,
        delay: 1500,
        uniqueId: "problem_statement_{{ original.id|default:'new' }}"
      }
    });
  }
});
</script>

<style>
.container{max-width:900px;margin:auto;font-family:sans-serif;}
.button{background:#3c8dbc;color:#fff;padding:6px 12px;border-radius:6px;text-decoration:none;}
.button:hover{background:#337ab7;}
.ai-buttons .button{margin-right:6px;}
</style>
{% endblock %}
