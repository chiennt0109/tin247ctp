{% extends "admin/change_form.html" %}
{% load static %}

{# ==== CSS/JS bá»• sung (editor, KaTeX, AI) ==== #}
{% block extrahead %}
{{ block.super }}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">

<script src="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<script src="{% static 'js/ai_editor.js' %}"></script>

<script>
document.addEventListener("DOMContentLoaded", function () {
  // Chá»‰ gáº¯n editor vÃ o Ä‘Ãºng textarea cá»§a Django Admin
  const textarea = document.querySelector("#id_statement");
  if (textarea) {
    new SimpleMDE({
      element: textarea,
      spellChecker: false,
      autosave: { enabled: true, delay: 1500, uniqueId: "problem_statement" },
      toolbar: [
        "bold","italic","heading","|","quote","unordered-list","ordered-list","|",
        "link","image","table","code","|","preview","side-by-side","fullscreen","|","guide"
      ],
      placeholder: "âœï¸ Nháº­p ná»™i dung bÃ i toÃ¡n (Markdown + KaTeX: $a^2+b^2=c^2$)..."
    });
  }
});
</script>

<style>
/* Má»™t Ã­t style nhá», khÃ´ng áº£nh hÆ°á»Ÿng core admin */
.ai-section .button { margin-right: 6px; margin-bottom: 6px; }
a.button-link {
  display:inline-block; background:#3c8dbc; color:#fff; padding:6px 12px;
  border-radius:6px; text-decoration:none;
}
a.button-link:hover { background:#337ab7; }
</style>
{% endblock %}

{# ==== ChÃ¨n thÃªm khá»‘i sau pháº§n field sets máº·c Ä‘á»‹nh cá»§a admin ==== #}
{% block after_field_sets %}
<div class="ai-section" style="margin-top: 16px;">
  <hr>
  <h3>ğŸ¤– AI Há»— trá»£ nháº­p liá»‡u</h3>
  <div>
    <button type="button" class="button" onclick="aiGenerateStatement()">âœ¨ Táº¡o Ä‘á» bÃ i</button>
    <button type="button" class="button" onclick="aiFixLatex()">ğŸ§  Sá»­a LaTeX</button>
    <button type="button" class="button" onclick="aiAutoTag()">ğŸ·ï¸ Gá»£i Ã½ Tags + Code + Difficulty</button>
  </div>
  <p id="aiResult" style="margin-top:10px;color:#333;"></p>
</div>

<hr>
<h3>ğŸ‘ Test Cases</h3>
{% if original and original.id %}
  <p>
    <a class="button-link" target="_blank" href="{% url 'admin:view_tests' original.id %}">ğŸ‘ Má»Ÿ danh sÃ¡ch test</a>
  </p>

  <hr>
  <h3>ğŸ“¦ Upload ZIP Test Cases</h3>
  <p style="margin:6px 0 10px;">
    Há»— trá»£ 2 cáº¥u trÃºc:
    <code>thumuc/test01.in, test01.out</code> hoáº·c
    <code>tenbai/test01/tenbai.inp, tenbai.out</code>
  </p>
  <form method="post" action="{% url 'admin:upload_tests' original.id %}" enctype="multipart/form-data">
    {% csrf_token %}
    <input type="file" name="zip_file" accept=".zip" required>
    <button type="submit" class="default btn btn-success" style="margin-top:6px;">
      â¬†ï¸ Upload vÃ  Import
    </button>
  </form>
{% else %}
  <p style="color:gray;">ğŸ’¡ HÃ£y lÆ°u bÃ i toÃ¡n trÆ°á»›c khi xem hoáº·c upload test case.</p>
{% endif %}
{% endblock %}

{# KhÃ´ng override cÃ¡c block khÃ¡c Ä‘á»ƒ giá»¯ nguyÃªn nÃºt LÆ°u/Save chuáº©n cá»§a Django Admin #}
