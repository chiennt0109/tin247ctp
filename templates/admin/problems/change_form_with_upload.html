{% extends "admin/change_form.html" %}
{% load static %}

{% block content %}
<div class="container">
  <button id="toggle-tests-btn" class="button" type="button" style="margin-bottom:10px;">
    👁 Hiện danh sách test case
  </button>

  <div id="testcase-section" style="display:none;">
    {{ block.super }}
  </div>

  {% if show_upload_button %}
  <hr>
  <h3>📦 Upload ZIP Test Cases</h3>
  <form action="{% url 'admin:upload_tests' original.id %}" method="post" enctype="multipart/form-data" style="margin-top: 1em;">
    {% csrf_token %}
    <p><input type="file" name="zip_file" accept=".zip" required></p>
    <button type="submit" class="default btn btn-success">⬆️ Upload và Import</button>
  </form>
  {% endif %}
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const btn = document.getElementById("toggle-tests-btn");
  const section = document.getElementById("testcase-section");
  let visible = false;

  btn.addEventListener("click", () => {
    visible = !visible;
    section.style.display = visible ? "block" : "none";
    btn.textContent = visible ? "🙈 Ẩn danh sách test case" : "👁 Hiện danh sách test case";
  });
});
</script>

<!-- ✅ Markdown Editor giữ nguyên -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.css">
<script src="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function() {
  const textarea = document.querySelector("#id_statement");
  if (textarea) {
    const mde = new SimpleMDE({
      element: textarea,
      spellChecker: false,
      autosave: { enabled: true, delay: 1500, uniqueId: "problem_statement" },
      renderingConfig: { singleLineBreaks: false, codeSyntaxHighlighting: true },
      toolbar: ["bold", "italic", "heading", "|", "quote", "unordered-list", "ordered-list", "|",
                "link", "image", "table", "code", "|", "preview", "side-by-side", "fullscreen", "|", "guide"],
      placeholder: "✏️ Nhập nội dung bài toán bằng Markdown...\n\n## Input\n## Output\n```cpp\nint main() {}\n```"
    });
  }
});
</script>

<style>
.container {
  max-width: 1000px;
}
.CodeMirror, .editor-toolbar {
  border-radius: 6px;
}
.editor-toolbar {
  background-color: #f8f9fa;
}
.editor-preview {
  background: #fff;
  padding: 1em;
  line-height: 1.6;
}
#toggle-tests-btn {
  background-color: #3c8dbc;
  color: white;
  padding: 6px 12px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  font-size: 14px;
}
#toggle-tests-btn:hover {
  background-color: #337ab7;
}
</style>
{% endblock %}
