{% extends "base.html" %}
{% block content %}
<div class="container py-4">
  <h3 class="fw-bold mb-3">üë§ H·ªì s∆° h·ªçc t·∫≠p: {{ user.username }}</h3>

  <div class="row g-4 mb-4">
    <div class="col-md-3">
      <div class="card shadow-sm border-0 rounded-4 text-center p-3">
        <h6 class="text-muted">ƒê√£ AC</h6>
        <h2 class="fw-bold text-success">{{ solved }}</h2>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm border-0 rounded-4 text-center p-3">
        <h6 class="text-muted">ƒêang l√†m</h6>
        <h2 class="fw-bold text-warning">{{ in_progress }}</h2>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm border-0 rounded-4 text-center p-3">
        <h6 class="text-muted">Ch∆∞a l√†m</h6>
        <h2 class="fw-bold text-secondary">{{ not_started }}</h2>
      </div>
    </div>
    <div class="col-md-3 text-center d-flex align-items-center justify-content-center">
      <a href="{% url 'change_password' %}" class="btn btn-outline-primary rounded-pill px-4 shadow-sm">üîí ƒê·ªïi m·∫≠t kh·∫©u</a>
    </div>
  </div>

  <div class="card border-0 shadow-sm rounded-4">
      <div class="card-header bg-light fw-semibold">üìà Ti·∫øn tr√¨nh h·ªçc</div>
      <div class="table-responsive">
          <table class="table align-middle mb-0">
              <thead class="table-light">
                  <tr>
                      <th>B√†i to√°n</th>
                      <th>Tr·∫°ng th√°i</th>
                      <th>L·∫ßn th·ª≠</th>
                      <th>ƒêi·ªÉm cao nh·∫•t</th>
                      <th>C·∫≠p nh·∫≠t</th>
                  </tr>
              </thead>
              <tbody>
                  {% for p in progresses %}
                  <tr>
                      <td><a href="{% url 'problem_detail' p.problem.id %}" class="text-decoration-none">{{ p.problem.title }}</a></td>
                      <td>
                          {% if p.status == 'solved' %}
                              <span class="badge bg-success">ƒê√£ AC</span>
                          {% elif p.status == 'in_progress' %}
                              <span class="badge bg-warning text-dark">ƒêang l√†m</span>
                          {% else %}
                              <span class="badge bg-secondary">Ch∆∞a l√†m</span>
                          {% endif %}
                      </td>
                      <td>{{ p.attempts }}</td>
                      <td>{{ p.best_score }}</td>
                      <td>{{ p.last_submit|date:"d/m/Y H:i" }}</td>
                  </tr>
                  {% empty %}
                  <tr><td colspan="5" class="text-center text-muted py-3">Ch∆∞a c√≥ d·ªØ li·ªáu ti·∫øn tr√¨nh.</td></tr>
                  {% endfor %}
              </tbody>
          </table>
      </div>
  </div>
</div>

<div class="text-center mt-4">
  <button id="btnAIPath" class="btn btn-outline-primary rounded-pill px-4 shadow-sm">
      ü§ñ Xem l·ªô tr√¨nh h·ªçc AI
  </button>
</div>

<div id="aiResult" class="mt-3 text-start"></div>

<script>
document.getElementById('btnAIPath').addEventListener('click', async () => {
  const res = await fetch('/problems/ai_learning_path/');
  const data = await res.json();
  let html = `<div class="card border-0 shadow-sm rounded-4 p-3 mt-3">
                 <h6 class="fw-bold mb-2">${data.summary || 'L·ªô tr√¨nh c√° nh√¢n h√≥a'}</h6>`;
  if (data.recommendations) {
    html += '<ul>';
    for (const r of data.recommendations) html += `<li>${r}</li>`;
    html += '</ul>';
  } else if (data.suggest) {
    html += '<ul>';
    for (const r of data.suggest) html += `<li>${r}</li>`;
    html += '</ul>';
  }
  html += '</div>';
  document.getElementById('aiResult').innerHTML = html;
});
</script>

{% endblock %}
