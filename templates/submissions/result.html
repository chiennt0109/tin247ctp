{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container mt-4">
    <h2>📝 Submission #{{ result.id }}</h2>
    <p><b>Problem:</b> {{ problem.title }} ({{ problem.code }})</p>
    <p><b>Status:</b> 
        {% if result.verdict == "Accepted" %}
            <span class="text-success fw-bold">✅ {{ result.verdict }}</span>
        {% elif "Time Limit" in result.verdict %}
            <span class="text-warning fw-bold">⏳ {{ result.verdict }}</span>
        {% elif "Runtime" in result.verdict %}
            <span class="text-danger fw-bold">💥 {{ result.verdict }}</span>
        {% else %}
            <span class="text-danger fw-bold">❌ {{ result.verdict }}</span>
        {% endif %}
    </p>
    <p><b>Execution Time:</b> {{ result.exec_time }}s</p>
    <p><b>Passed Tests:</b> {{ result.passed_tests }}/{{ result.total_tests }}</p>

    <hr>

    <h4>💻 Submitted Code</h4>
    <pre class="bg-dark text-light p-3 rounded">{{ result.source_code }}</pre>

    <hr>

    <h4>🧪 Debug Test Results</h4>

    <table class="table table-bordered table-striped">
        <thead class="table-dark">
            <tr>
                <th>#</th>
                <th>Input</th>
                <th>Expected Output</th>
                <th>Your Output</th>
                <th>Result</th>
            </tr>
        </thead>
        <tbody id="debug-body">
            <!-- JS will fill -->
        </tbody>
    </table>

    {{ result.debug_info|safe|json_script:"dbg" }}

    <script>
    try {
        const dbg = JSON.parse(document.getElementById("dbg").textContent);
        const tbody = document.getElementById("debug-body");

        dbg.forEach((t, i) => {
            tbody.innerHTML += `
            <tr>
                <td>${i+1}</td>
                <td><pre>${t.input}</pre></td>
                <td><pre>${t.expected}</pre></td>
                <td><pre>${t.got}</pre></td>

                <td class="fw-bold">
                    ${t.expected.trim() === t.got.trim()
                        ? "<span class='text-success'>✅</span>"
                        : "<span class='text-danger'>❌</span>"}
                </td>
            </tr>`;
        });
    } catch(e) {
        document.getElementById("debug-body").innerHTML = 
            "<tr><td colspan='5'><i>No detailed debug info</i></td></tr>";
    }
    </script>

    <br>

    <a href="/problems/{{ problem.id }}/" class="btn btn-secondary">⬅ Back to Problem</a>
    <a href="/submissions/my/" class="btn btn-primary">📂 My Submissions</a>

</div>
{% endblock %}
