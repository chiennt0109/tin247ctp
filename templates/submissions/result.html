{% comment %}
📁 path: templates/submissions/result.html
Hiển thị kết quả chấm bài và lịch sử nộp bài.
{% endcomment %}
{% extends "base.html" %}
{% load static %}

{% block title %}Kết quả nộp bài - {{ problem.title }}{% endblock %}

{% block content %}
<div class="container mt-4">

  <!-- 🧩 Thông tin bài toán -->
  <div class="mb-4">
    <h2>🧠 {{ problem.code }} – {{ problem.title }}</h2>
    <hr>
  </div>

  <!-- 🧾 Kết quả mới nhất -->
  <div class="card p-4 shadow-sm mb-4">
    <h4 class="mb-3">📊 Kết quả chấm bài</h4>

    {% if result %}
      {% if result.verdict == "Accepted" %}
        <h4><span class="badge bg-success">✅ Accepted</span></h4>
      {% elif "Wrong" in result.verdict %}
        <h4><span class="badge bg-danger">❌ {{ result.verdict }}</span></h4>
      {% elif "Time" in result.verdict %}
        <h4><span class="badge bg-warning text-dark">⏰ {{ result.verdict }}</span></h4>
      {% elif "Memory" in result.verdict %}
        <h4><span class="badge bg-warning text-dark">💾 {{ result.verdict }}</span></h4>
      {% else %}
        <h4><span class="badge bg-secondary">{{ result.verdict }}</span></h4>
      {% endif %}

      <p class="mt-3">
        ⏱ <b>Thời gian:</b> {{ result.exec_time }} giây<br>
        🧮 <b>Test qua:</b> {{ result.passed_tests }}/{{ result.total_tests }}
      </p>
    {% else %}
      <div class="alert alert-info">⚙️ Hệ thống chưa có kết quả chấm nào để hiển thị.</div>
    {% endif %}

    <div class="mt-3">
      <a href="{% url 'submission_create' problem.id %}" class="btn btn-primary">
        🔁 Nộp lại
      </a>
      <a href="/problems/" class="btn btn-secondary ms-2">
        ⬅️ Quay lại danh sách bài
      </a>
    </div>
  </div>

  <!-- 📜 Lịch sử nộp bài -->
  {% if submissions %}
    <div class="card p-4 shadow-sm">
      <h5 class="mb-3">🧾 Lịch sử nộp bài của bạn</h5>
      <table class="table table-striped align-middle">
        <thead class="table-light">
          <tr>
            <th scope="col">#</th>
            <th scope="col">Thời gian</th>
            <th scope="col">Ngôn ngữ</th>
            <th scope="col">Kết quả</th>
            <th scope="col">Thời gian chạy</th>
            <th scope="col">Test qua</th>
          </tr>
        </thead>
        <tbody>
          {% for s in submissions %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ s.created_at|date:"H:i:s d/m/Y" }}</td>
            <td><span class="badge bg-info text-dark">{{ s.language|upper }}</span></td>
            <td>
              {% if s.verdict == "Accepted" %}
                <span class="badge bg-success">✅ {{ s.verdict }}</span>
              {% elif "Wrong" in s.verdict %}
                <span class="badge bg-danger">❌ {{ s.verdict }}</span>
              {% elif "Time" in s.verdict %}
                <span class="badge bg-warning text-dark">⏰ {{ s.verdict }}</span>
              {% elif "Memory" in s.verdict %}
                <span class="badge bg-warning text-dark">💾 {{ s.verdict }}</span>
              {% else %}
                <span class="badge bg-secondary">{{ s.verdict }}</span>
              {% endif %}
            </td>
            <td>{{ s.exec_time }}s</td>
            <td>{{ s.passed_tests }}/{{ s.total_tests }}</td>
          </tr>
          {% empty %}
          <tr><td colspan="6" class="text-center">⚠️ Bạn chưa nộp bài nào cho bài toán này.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% endif %}
</div>
{% endblock %}
