{% extends "base.html" %}
{% load static %}
{% block content %}
<div class="container-fluid py-4" style="max-width:1200px;">
  <div class="card border-0 shadow-sm rounded-4 p-4">
    <div class="d-flex justify-content-between align-items-center flex-wrap">
      <div>
        <h3 class="fw-bold text-primary mb-1">üöÄ N·ªôp b√†i: {{ problem.title }}</h3>
        <div class="text-muted">
          ‚è± Gi·ªõi h·∫°n th·ªùi gian: <b>{{ problem.time_limit|default:"6" }}</b> gi√¢y
          {% if contest_id %}<br>üèÜ Thu·ªôc cu·ªôc thi ID: {{ contest_id }}{% endif %}
        </div>
      </div>
      <a href="{% if contest_id %}/contests/{{ contest_id }}/{% else %}/problems/{% endif %}"
         class="btn btn-outline-secondary rounded-pill">
        ‚¨ÖÔ∏è Quay l·∫°i
      </a>
    </div>

    <hr>

    <form method="POST" id="submitForm" class="mt-2">
      {% csrf_token %}
      <input type="hidden" name="contest_id" value="{{ contest_id|default:'' }}">

      <!-- Ng√¥n ng·ªØ -->
      <div class="mb-3">
        <label for="language" class="form-label fw-semibold">Ng√¥n ng·ªØ l·∫≠p tr√¨nh</label>
        <select class="form-select shadow-sm" id="language" name="language" required onchange="changeMode()">
          <option value="">-- Ch·ªçn ng√¥n ng·ªØ --</option>
          <option value="python">üêç Python 3</option>
          <option value="pypy">‚ö° PyPy 3</option>
          <option value="cpp">üíª C++17</option>
          <option value="java">‚òï Java</option>
        </select>
      </div>

      <!-- Ace Editor -->
      <div class="mb-3">
        <label class="form-label fw-semibold">M√£ ngu·ªìn</label>
        <div id="editor" class="border rounded-3 shadow-sm" style="height:480px;"># Vi·∫øt code c·ªßa b·∫°n t·∫°i ƒë√¢y...</div>
        <textarea name="source" id="source" style="display:none;"></textarea>
      </div>

      <!-- N√∫t thao t√°c -->
      <div class="d-flex justify-content-between align-items-center mt-4">
        <button type="submit" class="btn btn-primary rounded-pill px-4 py-2 fw-semibold shadow-sm">
          üíæ N·ªôp b√†i
        </button>
        <div class="text-muted small">
          üí° G·ª£i √Ω: B·∫°n c√≥ th·ªÉ sao ch√©p code t·ª´ IDE c·ªßa m√¨nh v√† d√°n tr·ª±c ti·∫øp t·∫°i ƒë√¢y.
        </div>
      </div>
    </form>
  </div>
</div>

<!-- Ace Editor -->
<script src="https://cdn.jsdelivr.net/npm/ace-builds@1.32.3/src-min-noconflict/ace.js"></script>
<script src="https://cdn.jsdelivr.net/npm/ace-builds@1.32.3/src-min-noconflict/ext-language_tools.js"></script>

<script>
  const editor = ace.edit("editor");
  editor.setTheme("ace/theme/monokai");
  editor.session.setMode("ace/mode/python");
  editor.setOptions({
    enableBasicAutocompletion: true,
    enableLiveAutocompletion: true,
    showPrintMargin: false,
    fontSize: "15px",
    wrap: true,
    highlightActiveLine: true,
  });

  function changeMode() {
    const lang = document.getElementById("language").value;
    if (lang === "cpp") editor.session.setMode("ace/mode/c_cpp");
    else if (lang === "java") editor.session.setMode("ace/mode/java");
    else editor.session.setMode("ace/mode/python");
  }

  document.getElementById("submitForm").addEventListener("submit", function (e) {
    const code = editor.getValue().trim();
    const lang = document.getElementById("language").value;

    if (!lang) {
      e.preventDefault();
      alert("‚ö†Ô∏è B·∫°n ch∆∞a ch·ªçn ng√¥n ng·ªØ!");
      return false;
    }
    if (code.length === 0) {
      e.preventDefault();
      alert("‚ö†Ô∏è B·∫°n ch∆∞a nh·∫≠p m√£ ngu·ªìn!");
      return false;
    }

    document.getElementById("source").value = code;
  });
</script>

<style>
/* T√πy ch·ªânh m∆∞·ª£t m√† v√† tho√°ng */
.card {
  background: #ffffff;
  border-radius: 18px;
  transition: 0.2s;
}
.card:hover { box-shadow: 0 8px 22px rgba(0,0,0,0.08); }

select.form-select {
  border-radius: 10px;
  padding: 0.6rem 1rem;
}

.btn-primary {
  background: linear-gradient(90deg, #2563eb, #1e40af);
  border: none;
}
.btn-primary:hover {
  background: linear-gradient(90deg, #1d4ed8, #1e3a8a);
}

#editor {
  font-family: "Fira Code", monospace;
  border: 1px solid #e5e7eb;
}
</style>
{% endblock %}
