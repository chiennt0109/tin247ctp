{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container mt-4">

  <a href="{% url 'problem_list' %}" class="btn btn-outline-secondary mb-3">â¬… Quay láº¡i danh sÃ¡ch</a>

  <div class="d-flex justify-content-between align-items-center mb-2">
    <h3 class="fw-bold">{{ problem.code }} â€” {{ problem.title }}</h3>
    <a href="{% url 'submission_create' problem.id %}" class="btn btn-success">ğŸš€ Gá»­i bÃ i</a>
  </div>

  <p class="mb-1">
    <b>Äá»™ khÃ³:</b>
    {% if problem.difficulty == "Easy" %}
      <span class="badge rounded-pill text-bg-success">Easy</span>
    {% elif problem.difficulty == "Medium" %}
      <span class="badge rounded-pill text-bg-warning">Medium</span>
    {% else %}
      <span class="badge rounded-pill text-bg-danger">Hard</span>
    {% endif %}
  </p>

  <p class="text-muted"><b>ÄÃ£ AC:</b> {{ ac_count }} / {{ submit_count }} lÆ°á»£t</p>

  <!-- âœ… Card gá»n, giá»‘ng Roadmap -->
  <div class="card shadow-sm border-0 p-4 mb-4">
    <div id="problem-statement" class="problem-statement">
      {{ problem.statement|safe }}
    </div>
  </div>

  <!-- ğŸ¤– AI Tools -->
  <h5 class="fw-semibold mb-2">ğŸ¤– Há»— trá»£ AI</h5>
  <div class="d-flex gap-2 flex-wrap mb-2">
    <button onclick="aiHint()" class="btn btn-warning">ğŸ’¡ Gá»£i Ã½</button>
    <button onclick="aiRecommend()" class="btn btn-info text-white">ğŸ“Œ BÃ i káº¿ tiáº¿p</button>
    <button onclick="aiPath()" class="btn btn-primary">ğŸ“š Lá»™ trÃ¬nh</button>
  </div>

  <div id="aiBox" class="alert alert-secondary d-none"></div>
</div>

<style>
.problem-statement {
  white-space: pre-wrap;
  line-height: 1.62;
  font-size: 1.05rem;
}
</style>

<!-- âœ… MathJax -->
<script>
window.MathJax = {
  tex: { inlineMath: [['$', '$'], ['\\(', '\\)']], displayMath: [['$$','$$'], ['\\[','\\]']] },
  svg: { fontCache: 'global' }
};
</script>
<script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<script>
function show(t){const b=document.getElementById("aiBox");b.classList.remove("d-none");b.innerHTML=t;}

function aiHint(){
  fetch(`/problems/{{ problem.id }}/ai_hint_real/`)
    .then(r=>r.ok?r.json():Promise.reject())
    .then(d=>show("ğŸ’¡ "+(d.result||d.hint||"KhÃ´ng cÃ³ dá»¯ liá»‡u")))
    .catch(()=>show("âš ï¸ Lá»—i gá»i gá»£i Ã½."));
}

function aiRecommend(){
  fetch(`/problems/{{ problem.id }}/ai_recommend/`)
    .then(r=>r.ok?r.json():Promise.reject())
    .then(d=>show("â¡ï¸ "+(d.result||"KhÃ´ng cÃ³ dá»¯ liá»‡u")))
    .catch(()=>show("âš ï¸ Lá»—i gá»£i Ã½ bÃ i tiáº¿p theo."));
}

function aiPath(){
  fetch(`/problems/ai_learning_path/`)
    .then(r=>r.ok?r.json():Promise.reject())
    .then(d=>show("ğŸ“š "+(d.summary?d.summary:JSON.stringify(d))))
    .catch(()=>show("âš ï¸ Lá»—i lá»™ trÃ¬nh há»c."));
}
</script>
{% endblock %}
