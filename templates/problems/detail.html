{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container mt-4">

    <a href="{% url 'problem_list' %}" class="btn btn-outline-secondary mb-3">â¬… Quay láº¡i danh sÃ¡ch</a>

    <div class="d-flex justify-content-between align-items-center mb-2">
        <h3 class="fw-bold text-primary">{{ problem.code }} â€“ {{ problem.title }}</h3>
        <a href="{% url 'submission_create' problem.id %}" class="btn btn-success btn-lg">ğŸš€ Gá»­i bÃ i</a>
    </div>

    <p><b>Äá»™ khÃ³:</b>
        {% if problem.difficulty == "Easy" %}
            ğŸŸ¢ Easy
        {% elif problem.difficulty == "Medium" %}
            ğŸŸ¡ Medium
        {% else %}
            ğŸ”´ Hard
        {% endif %}
    </p>

    <p><b>ÄÃ£ AC:</b> {{ ac_count }} / {{ submit_count }} lÆ°á»£t</p>

    <hr>

    <!-- âœ… markdown container -->
    <div id="statement" class="card p-4 mb-4 shadow-sm" style="background: #fff;"></div>

    <hr>

    <h4>ğŸ¤– Há»— trá»£ AI</h4>
    <button onclick="aiHint()" class="btn btn-warning">ğŸ’¡ Gá»£i Ã½</button>
    <button onclick="aiRecommend()" class="btn btn-info">ğŸ“Œ BÃ i káº¿</button>
    <button onclick="aiPath()" class="btn btn-primary">ğŸ“š Lá»™ trÃ¬nh</button>

    <div id="aiBox" class="mt-3 p-3 border rounded" style="display:none;"></div>

</div>

<script>
const rawMarkdown = `{{ problem.statement|escapejs }}`;

function showAI(text) {
    const box = document.getElementById("aiBox");
    box.style.display = "block";
    box.innerHTML = text;
}

function aiHint() {
    fetch(`/problems/{{ problem.id }}/ai_hint/`)
    .then(r=>r.json()).then(d=>showAI("ğŸ’¡ " + d.hint));
}
function aiRecommend() {
    fetch(`/problems/{{ problem.id }}/ai_recommend/`)
    .then(r=>r.json()).then(d=>showAI("â¡ï¸ " + d.result));
}
function aiPath() {
    fetch(`/problems/ai_learning_path/`)
    .then(r=>r.json()).then(d=>showAI("ğŸ“š " + JSON.stringify(d, null, 2)));
}
</script>

<!-- âœ… markdown + highlight.js + katex -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github.min.css">
<script src="https://cdn.jsdelivr.net/npm/markdown-it@13.0.1/dist/markdown-it.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/common.min.js"></script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js"></script>

<script>
const md = window.markdownit({
    html: true,
    linkify: true,
    highlight: function (str, lang) {
        try { return hljs.highlight(str, { language: lang }).value; }
        catch (__) { return ''; }
    }
});

document.getElementById("statement").innerHTML = md.render(rawMarkdown);

document.addEventListener("DOMContentLoaded", function() {
  renderMathInElement(document.body);
});
</script>

{% endblock %}
