{% extends 'base.html' %}
{% block content %}

<div class="problem-container">
  <h2>{{ p.code }} – {{ p.title }}</h2>

  <!-- chứa markdown thô trong textarea ẩn -->
  <textarea id="md-src" hidden>{{ p.statement }}</textarea>

  <!-- nơi render ra HTML -->
  <div id="problem-statement" class="markdown-body"></div>

  <p><b>Limits:</b> {{ p.time_limit }}s, {{ p.memory_limit }}MB</p>
  <p><a href="/submissions/{{ p.id }}/submit/">Submit solution</a></p>
</div>

<!-- 1) Markdown render -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function() {
  const src = document.getElementById("md-src");
  const out = document.getElementById("problem-statement");
  if (src && out) {
    // marked sẽ xử lý markdown -> HTML
    out.innerHTML = marked.parse(src.value || "");
  }
});
</script>

<!-- 2) KaTeX chỉ trong khu vực đề bài -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function() {
  const scope = document.getElementById("problem-statement");
  if (scope && window.renderMathInElement) {
    renderMathInElement(scope, {
      delimiters: [
        { left: "$$", right: "$$", display: true },
        { left: "$", right: "$", display: false }
      ]
    });
  }
});
</script>

<!-- 3) Highlight code -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  document.querySelectorAll('#problem-statement pre code').forEach((el) => {
    try { hljs.highlightElement(el); } catch(e) {}
  });
});
</script>

<style>
.problem-container { max-width: 900px; margin: 0 auto; padding: 1.5rem; font-family: system-ui, sans-serif; }
.markdown-body { line-height: 1.6; font-size: 16px; }
.markdown-body pre code { background-color: #f6f8fa; padding: 10px; display: block; border-radius: 6px; overflow-x: auto; }
.markdown-body table { border-collapse: collapse; }
.markdown-body table th, .markdown-body table td { border: 1px solid #ddd; padding: 6px 10px; }
.markdown-body h1, .markdown-body h2, .markdown-body h3 { margin-top: 1.2em; font-weight: 600; }
</style>

{% endblock %}
