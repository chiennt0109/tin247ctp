{% extends "base.html" %}
{% load static %}

{% block content %}

<style>
.problem-page {
    max-width: 860px;
    margin: auto;
    padding: 1rem;
}
.problem-paper {
    background: white;
    padding: 2rem;
    border-radius: 10px;
    box-shadow: 0 4px 14px rgba(0,0,0,0.08);
}
.btn-top-actions {
    display: flex;
    justify-content: space-between;
    margin-bottom: 1rem;
}
.problem-title {
    font-weight: 700;
    font-size: 1.45rem;
}
.markdown-body {
    font-size: 1rem;
    line-height: 1.65;
}
.markdown-body pre, code {
    background: #f6f8fa;
    padding: 8px;
    border-radius: 6px;
}
.markdown-body table {
    width: 100%;
    border-collapse: collapse;
}
.markdown-body th, .markdown-body td {
    padding: 6px;
    border: 1px solid #ddd;
}
</style>

<div class="problem-page">

    <!-- ‚úÖ Top buttons -->
    <div class="btn-top-actions">
        <a href="{% url 'problem_list' %}" class="btn btn-outline-secondary rounded-pill">‚¨Ö Quay l·∫°i</a>
        <a href="{% url 'submission_create' problem.id %}" class="btn btn-success rounded-pill">üöÄ N·ªôp b√†i</a>
    </div>

    <!-- ‚úÖ Problem content card (PDF style) -->
    <div class="problem-paper">
        
        <div class="problem-title">{{ problem.title }}</div>
        <div class="text-muted mb-2">{{ problem.code }}</div>

        {% if problem.difficulty %}
        <span class="badge text-bg-success">{{ problem.difficulty }}</span>
        {% endif %}

        {% for tag in problem.tags.all %}
        <span class="badge bg-info text-dark">#{{ tag.name }}</span>
        {% endfor %}

        <hr>

        <!-- ‚úÖ Render Markdown + LaTeX -->
        <div id="problem-content" class="markdown-body">
            {{ problem.statement|safe }}
        </div>

        <hr>
        <p><strong>‚úÖ ƒê√£ AC:</strong> {{ ac_count }} / {{ submit_count }} submissions</p>
    </div>

    <!-- ‚úÖ AI buttons below paper -->
    <div class="mt-3 d-flex flex-wrap gap-2">

        <button id="ai-hint" class="btn btn-primary rounded-pill">üí° G·ª£i √Ω AI</button>
        <button id="ai-solve" class="btn btn-outline-primary rounded-pill">üß† H∆∞·ªõng d·∫´n AI</button>
        <button id="copy-problem" class="btn btn-outline-dark rounded-pill">üìã Copy ƒë·ªÅ</button>

    </div>

</div>

<!-- ‚úÖ MathJax -->
<script>
window.MathJax = {
    tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] }
};
</script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<!-- ‚úÖ Markdown Render -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
const raw = document.getElementById("problem-content").innerText;
document.getElementById("problem-content").innerHTML = marked.parse(raw);
MathJax.typesetPromise();
</script>

<!-- ‚úÖ Buttons Logic -->
<script>
document.getElementById("ai-hint").onclick = () => {
    window.location.href = "/problems/{{ problem.id }}/ai_hint/";
};

document.getElementById("ai-solve").onclick = () => {
    window.location.href = "/problems/{{ problem.id }}/ai_solution/";
};

document.getElementById("copy-problem").onclick = () => {
    navigator.clipboard.writeText(document.getElementById("problem-content").innerText);
    alert("‚úÖ ƒê√£ copy ƒë·ªÅ!");
};
</script>

{% endblock %}
