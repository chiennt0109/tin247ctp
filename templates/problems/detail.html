{# ===============================================================
üìÑ FILE: templates/problems/detail.html
üìå CH·ª®C NƒÇNG:
- Hi·ªÉn th·ªã ƒë·ªÅ b√†i (markdown + c√¥ng th·ª©c to√°n KaTeX + highlight code)
- Hi·ªÉn th·ªã gi·ªõi h·∫°n th·ªùi gian/b·ªô nh·ªõ
- N√∫t "üöÄ N·ªôp b√†i" d·∫´n t·ªõi trang submit t∆∞∆°ng ·ª©ng
- ƒê·∫£m b·∫£o render c√¥ng th·ª©c ƒë√∫ng th·ª© t·ª± sau markdown
=============================================================== #}

{% extends 'base.html' %}
{% block content %}

<div class="problem-container">
  <h2>{{ problem.code }} ‚Äì {{ problem.title }}</h2>

  <!-- üîπ 1Ô∏è‚É£ Ngu·ªìn markdown th√¥ -->
  <textarea id="md-src" hidden>{{ problem.statement }}</textarea>

  <!-- üîπ 2Ô∏è‚É£ Khu v·ª±c render ra HTML -->
  <div id="problem-statement" class="markdown-body"></div>

  <!-- üîπ 3Ô∏è‚É£ Gi·ªõi h·∫°n -->
  <p><b>‚è± Gi·ªõi h·∫°n:</b> {{ problem.time_limit }}s, {{ problem.memory_limit }}MB</p>

  <!-- üîπ 4Ô∏è‚É£ N√∫t n·ªôp b√†i -->
  <div class="text-center mt-4 mb-2">
    <a href="{% url 'submission_create' problem.id %}" class="btn btn-success btn-lg">
      üöÄ N·ªôp b√†i
    </a>
    <a href="/problems/" class="btn btn-secondary btn-lg ms-2">‚¨ÖÔ∏è Quay l·∫°i danh s√°ch</a>
  </div>
</div>

<!-- ==========================================================
üß© 1) Markdown + KaTeX + HighlightJS (hi·ªÉn th·ªã ƒë·ªÅ b√†i)
========================================================== -->

<!-- ‚úÖ Th∆∞ vi·ªán CSS/JS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const src = document.getElementById("md-src");
  const out = document.getElementById("problem-statement");

  if (src && out) {
    // 1Ô∏è‚É£ Render Markdown sang HTML
    out.innerHTML = marked.parse(src.value || "");

    // 2Ô∏è‚É£ Render KaTeX (c√¥ng th·ª©c to√°n h·ªçc)
    if (window.renderMathInElement) {
      renderMathInElement(out, {
        delimiters: [
          { left: "$$", right: "$$", display: true },
          { left: "$", right: "$", display: false }
        ],
        throwOnError: false
      });
    }

    // 3Ô∏è‚É£ Highlight code trong kh·ªëi <pre><code>
    document.querySelectorAll('#problem-statement pre code').forEach(el => {
      try { hljs.highlightElement(el); } catch (e) {}
    });
  }
});
</script>

<!-- ==========================================================
üé® 2) CSS hi·ªÉn th·ªã
========================================================== -->
<style>
.problem-container {
  max-width: 900px;
  margin: 0 auto;
  padding: 1.5rem;
  font-family: system-ui, sans-serif;
}

.markdown-body {
  line-height: 1.6;
  font-size: 16px;
  color: #222;
}

.markdown-body pre code {
  background-color: #f6f8fa;
  padding: 10px;
  display: block;
  border-radius: 6px;
  overflow-x: auto;
  font-size: 14px;
}

.markdown-body table {
  border-collapse: collapse;
  margin: 10px 0;
}
.markdown-body table th,
.markdown-body table td {
  border: 1px solid #ddd;
  padding: 6px 10px;
}

.markdown-body h1, .markdown-body h2, .markdown-body h3 {
  margin-top: 1.2em;
  font-weight: 600;
}

/* üßÆ KaTeX hi·ªÉn th·ªã c√¢n ƒë·ªëi */
.markdown-body .katex-display {
  margin: 1em 0;
  text-align: center;
}
.markdown-body .katex {
  font-size: 1.1em;
}
</style>

{% endblock %}
