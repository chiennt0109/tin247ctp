{% extends "base.html" %}
{% block content %}
<div class="container" style="max-width:900px;margin:0 auto;padding:20px;">
  <h2>ğŸ“˜ {{ problem.code }} â€“ {{ problem.title }}</h2>

  <div>
    <span class="badge bg-info">â± {{ problem.time_limit }}s</span>
    <span class="badge bg-secondary">ğŸ’¾ {{ problem.memory_limit }}MB</span>
    <span class="badge bg-warning text-dark">ğŸ· {{ problem.difficulty }}</span>
  </div>

  <hr>
  <div class="problem-statement" style="line-height:1.6;">
    {{ problem.statement|safe }}
  </div>

  <hr>
  <h4>ğŸ§  Trá»£ lÃ½ há»c táº­p</h4>
  <button id="hint-btn" class="btn btn-outline-primary btn-sm">ğŸ’¡ Nháº­n gá»£i Ã½ AI</button>
  <div id="ai-response" style="margin-top:10px;padding:10px;background:#f8f9fa;border-radius:6px;min-height:40px;"></div>

  <hr>
  <h4>ğŸ§ª Test cases</h4>
  {% if problem.testcase_set.all %}
    <table class="table table-sm table-striped">
      <thead><tr><th>#</th><th>Input</th><th>Output</th></tr></thead>
      <tbody>
        {% for t in problem.testcase_set.all %}
        <tr>
          <td>{{ forloop.counter }}</td>
          <td><pre>{{ t.input_data|truncatechars:100 }}</pre></td>
          <td><pre>{{ t.expected_output|truncatechars:100 }}</pre></td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p>âš ï¸ ChÆ°a cÃ³ test nÃ o Ä‘Æ°á»£c thÃªm cho bÃ i nÃ y.</p>
  {% endif %}
</div>

<script>
document.getElementById("hint-btn").addEventListener("click", function() {
  const resBox = document.getElementById("ai-response");
  resBox.innerHTML = "â³ Äang láº¥y gá»£i Ã½...";
  fetch("{% url 'ai_hint' problem.id %}")
    .then(r => r.json())
    .then(data => {
      resBox.innerHTML = data.hint || "ğŸ¤– KhÃ´ng cÃ³ gá»£i Ã½.";
    })
    .catch(() => {
      resBox.innerHTML = "âš ï¸ KhÃ´ng thá»ƒ káº¿t ná»‘i mÃ¡y chá»§ gá»£i Ã½.";
    });
});
</script>
{% endblock %}
