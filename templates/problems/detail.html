{% extends "base.html" %}
{% block content %}
<div class="container py-4" style="max-width:900px;margin:0 auto;">

  <a href="{% url 'problem_list' %}" style="text-decoration:none;font-size:0.9rem;">← Quay lại danh sách</a>

  <h2 style="margin-top:8px;">
    {{ p.code }} – {{ p.title }}
  </h2>

  <div style="font-size:0.9rem;color:#555;margin-bottom:12px;">
    <b>Độ khó:</b> {{ p.difficulty }}
    &nbsp;|&nbsp;
    <b>Giới hạn:</b> {{ p.time_limit }}s / {{ p.memory_limit }}MB
    <br>
    <b>Tag:</b>
    {% for t in p.tags.all %}
      <span style="
        background:#eef;
        border:1px solid #99c;
        border-radius:4px;
        padding:2px 6px;
        font-size:0.75rem;
        display:inline-block;
        margin:1px 2px;
      ">{{ t.name }}</span>
    {% empty %}
      <span style="color:#888;">—</span>
    {% endfor %}
    <br>
    <b>AC:</b> {{ p.ac_count }} / {{ p.submission_count }}
    ({{ p.success_rate }}%)
    {% if p.ai_supported %}
      &nbsp;|&nbsp;
      <span title="AI Hint / Debug hỗ trợ bài này"
            style="display:inline-block;background:#222;color:#fff;
                   font-size:0.7rem;line-height:1;border-radius:4px;
                   padding:3px 5px;font-family:monospace;">
        AI
      </span>
    {% endif %}
    {% if p.has_editorial %}
      &nbsp;|&nbsp; 📘 Có lời giải mẫu
    {% endif %}
  </div>

  <hr>

  <h3>Mô tả bài toán</h3>
  <div style="
      background:#fafafa;
      border:1px solid #ddd;
      border-radius:6px;
      padding:16px;
      font-family: ui-monospace, SFMono-Regular, Consolas, monospace;
      font-size:0.9rem;
      line-height:1.45;
      white-space:pre-wrap;
      overflow-x:auto;
    ">
    {{ p.statement }}
  </div>

  <div style="margin-top:24px;">
    <a href="/submissions/{{ p.id }}/submit/"
       style="text-decoration:none;background:#2e7d32;color:#fff;
              padding:10px 14px;border-radius:4px;font-size:0.9rem;
              display:inline-block;">
      🚀 Gửi bài
    </a>
  </div>

  {% if p.ai_supported %}
  <hr>
  <div id="ai-section" style="margin-top:20px;">
    <button id="aiHintBtn"
            style="background:#1976d2;color:#fff;padding:8px 12px;
                   border:none;border-radius:4px;cursor:pointer;">
      🤖 Nhận gợi ý
    </button>
    <div id="aiHintResult" style="margin-top:10px;color:#333;font-style:italic;"></div>
  </div>

  <script>
  document.getElementById('aiHintBtn').addEventListener('click', async () => {
    const btn = document.getElementById('aiHintBtn');
    const out = document.getElementById('aiHintResult');
    btn.disabled = true;
    btn.innerText = "Đang phân tích...";
    try {
      const res = await fetch(window.location.pathname + 'ai_hint/');
      const data = await res.json();
      out.textContent = data.hint;
    } catch (e) {
      out.textContent = "❌ Lỗi khi lấy gợi ý. Thử lại sau nhé.";
    }
    btn.innerText = "🤖 Nhận gợi ý khác";
    btn.disabled = false;
  });
  </script>
  {% endif %}

</div>
{% endblock %}
