{% extends "base.html" %}
{% block content %}
<div class="container" style="max-width:900px;margin:0 auto;padding:20px;">
  <h2>📘 {{ problem.code }} – {{ problem.title }}</h2>

  <div>
    <span class="badge bg-info">⏱ {{ problem.time_limit }}s</span>
    <span class="badge bg-secondary">💾 {{ problem.memory_limit }}MB</span>
    <span class="badge bg-warning text-dark">🏷 {{ problem.difficulty }}</span>
  </div>

  <hr>
  <div class="problem-statement" style="line-height:1.6;">
    {{ problem.statement|safe }}
  </div>

  <hr>
  <h4>🧠 Trợ lý học tập</h4>
  <button id="hint-btn" class="btn btn-outline-primary btn-sm">💡 Nhận gợi ý AI</button>
  <div id="ai-response" style="margin-top:10px;padding:10px;background:#f8f9fa;border-radius:6px;min-height:40px;"></div>

  <hr>
  <h4>🧪 Test cases</h4>
  {% if problem.testcase_set.all %}
    <table class="table table-sm table-striped">
      <thead><tr><th>#</th><th>Input</th><th>Output</th></tr></thead>
      <tbody>
        {% for t in problem.testcase_set.all %}
        <tr>
          <td>{{ forloop.counter }}</td>
          <td><pre>{{ t.input_data|truncatechars:100 }}</pre></td>
          <td><pre>{{ t.expected_output|truncatechars:100 }}</pre></td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p>⚠️ Chưa có test nào được thêm cho bài này.</p>
  {% endif %}
</div>

<script>
document.getElementById("hint-btn").addEventListener("click", function() {
  const resBox = document.getElementById("ai-response");
  resBox.innerHTML = "⏳ Đang lấy gợi ý...";
  fetch("{% url 'ai_hint' problem.id %}")
    .then(r => r.json())
    .then(data => {
      resBox.innerHTML = data.hint || "🤖 Không có gợi ý.";
    })
    .catch(() => {
      resBox.innerHTML = "⚠️ Không thể kết nối máy chủ gợi ý.";
    });
});
</script>
{% endblock %}
