{% extends "base.html" %}
{% load static %}

{% block extra_head %}
<!-- MathJax -->
<script>
window.MathJax = {
  tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
  svg: { fontCache: 'global' }
};
</script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>

<style>
/* PDF Reader Style */
.problem-wrapper {
  display: flex;
  justify-content: center;
  padding-top: 1rem;
  padding-bottom: 4rem;
  background: #f5f7fa;
}

.problem-paper {
  background: white;
  width: 860px;
  min-height: 1000px;
  padding: 40px 45px;
  border-radius: 8px;
  border: 1px solid #e5e7eb;
  box-shadow: 0 5px 25px rgba(0,0,0,0.07);
  font-size: 1.02rem;
  line-height: 1.7;
  color: #111;
}

.problem-paper h1, .problem-paper h2 {
  font-weight: 700;
}

.code-block {
  background: #1e293b;
  color: #fff;
  padding: 12px;
  border-radius: 6px;
  font-family: monospace;
  font-size: 0.9rem;
  overflow-x: auto;
}

.action-zone {
  display: flex;
  gap: .75rem;
  padding: 1.2rem;
  justify-content: center;
  flex-wrap: wrap;
}
</style>
{% endblock %}

{% block content %}

<div class="problem-wrapper">

  <div class="problem-paper">

      <!-- Title -->
      <h2 class="fw-bold mb-3">{{ problem.title }}</h2>
      <p class="text-muted mb-4">{{ problem.code }}</p>

      <!-- Difficulty + Tag -->
      <p>
        {% if problem.difficulty == "Easy" %}
          <span class="badge bg-success-subtle text-success-emphasis">üü¢ Easy</span>
        {% elif problem.difficulty == "Medium" %}
          <span class="badge bg-warning-subtle text-warning-emphasis">üü° Medium</span>
        {% else %}
          <span class="badge bg-danger-subtle text-danger-emphasis">üî¥ Hard</span>
        {% endif %}

        {% for t in problem.tags.all %}
        <span class="badge bg-info-subtle text-info-emphasis">{{ t.name }}</span>
        {% endfor %}
      </p>

      <hr>

      <!-- Problem Statement (Markdown / MathJax) -->
      <div class="markdown-body" id="problem-content">
        {{ problem.statement|safe }}
      </div>

      <hr class="my-4">

      <!-- Input/Output samples -->
      {% if problem.samples.all %}
        <h5 class="fw-bold mb-2">üìò V√≠ d·ª• m·∫´u</h5>
        {% for s in problem.samples.all %}
          <div class="mb-3">
            <div><strong>Input:</strong></div>
            <pre class="code-block">{{ s.input }}</pre>
            <div><strong>Output:</strong></div>
            <pre class="code-block">{{ s.output }}</pre>
          </div>
        {% endfor %}
      {% endif %}

  </div>
</div>



<!-- ‚úÖ Actions below PDF viewer -->
<div class="action-zone">
  <a href="{% url 'submission_create' problem.id %}" class="btn btn-success rounded-pill px-4">
    üöÄ N·ªôp b√†i
  </a>

  <button id="btn-ai-hint" class="btn btn-primary rounded-pill px-4">
    üí° G·ª£i √Ω AI
  </button>

  <button id="btn-ai-solve" class="btn btn-outline-primary rounded-pill px-4">
    üß† Xem h∆∞·ªõng gi·∫£i AI
  </button>

  <button id="btn-copy" class="btn btn-outline-dark rounded-pill px-4">
    üìã Copy ƒë·ªÅ
  </button>

  <a href="/problems/" class="btn btn-secondary rounded-pill px-4">
    ‚¨ÖÔ∏è Quay l·∫°i danh s√°ch
  </a>
</div>


<script>
// Copy problem statement
document.getElementById("btn-copy").onclick = () => {
  const text = document.getElementById("problem-content").innerText;
  navigator.clipboard.writeText(text);
  alert("‚úÖ ƒê√£ copy n·ªôi dung ƒë·ªÅ");
};

// AI Hint
document.getElementById("btn-ai-hint").onclick = () =>
  window.location.href = "/problems/{{ problem.id }}/ai_hint/";

// AI Solve
document.getElementById("btn-ai-solve").onclick = () =>
  window.location.href = "/problems/{{ problem.id }}/ai_solution/";
</script>

<!-- ‚úÖ MathJax -->
<script>
window.MathJax = {
  tex: { inlineMath: [['$','$'], ['\\(','\\)']] },
  svg: { fontCache: 'global' }
};
</script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>

<!-- ‚úÖ Markdown render (kh√¥ng c·∫ßn build) -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
document.getElementById("problem-content").innerHTML =
    marked.parse(document.getElementById("problem-content").innerText);
MathJax.typesetPromise();
</script>


{% endblock %}
