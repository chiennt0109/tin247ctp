{% extends "base.html" %}
{% block content %}
<div class="container py-4">

  <h2 class="mb-3">üß© Danh s√°ch b√†i to√°n</h2>

  <!-- B·ªô l·ªçc -->
  <form method="get" class="mb-4" style="display:flex;flex-wrap:wrap;gap:12px;align-items:flex-end;">
    <div>
      <label style="font-size:0.9rem;color:#555;">Tag</label><br>
      <select name="tag" style="min-width:150px;padding:6px 8px;">
        <option value="">-- T·∫•t c·∫£ --</option>
        {% for tag in tags %}
          <option value="{{ tag.slug }}" {% if tag.slug == selected_tag %}selected{% endif %}>
            {{ tag.name }}
          </option>
        {% endfor %}
      </select>
    </div>

    <div>
      <label style="font-size:0.9rem;color:#555;">ƒê·ªô kh√≥</label><br>
      <select name="difficulty" style="min-width:120px;padding:6px 8px;">
        <option value="">-- T·∫•t c·∫£ --</option>
        {% for level in difficulty_levels %}
          <option value="{{ level }}" {% if selected_difficulty == level %}selected{% endif %}>
            {{ level }}
          </option>
        {% endfor %}
      </select>
    </div>

    <div style="display:flex;gap:8px;">
      <button type="submit" style="padding:6px 12px;">L·ªçc</button>
      <a href="{% url 'problem_list' %}" style="padding:6px 12px; background:#eee; border-radius:4px; text-decoration:none; color:#333;">
        üßπ Reset
      </a>
    </div>
  </form>

  <!-- B·∫£ng b√†i to√°n -->
  <div style="overflow-x:auto;">
    <table cellspacing="0" cellpadding="8" style="width:100%;border-collapse:collapse;font-size:0.95rem;">
      <thead>
        <tr style="background:#f5f5f5;text-align:left;border-bottom:1px solid #ddd;">
          <th style="white-space:nowrap;">M√£</th>
          <th>Ti√™u ƒë·ªÅ</th>
          <th style="white-space:nowrap;">ƒê·ªô kh√≥</th>
          <th>Tag</th>
          <th style="white-space:nowrap;">AC / Submit</th>
          <th style="text-align:center;white-space:nowrap;">AI</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for p in problems %}
        <tr style="border-bottom:1px solid #eee;">
          <td style="font-family:monospace;white-space:nowrap;">{{ p.code }}</td>

          <td>
            <div style="font-weight:600;">{{ p.title }}</div>
            {% if p.has_editorial %}
              <div style="font-size:0.8rem;color:#555;">üìò C√≥ l·ªùi gi·∫£i m·∫´u</div>
            {% endif %}
          </td>

          <td style="white-space:nowrap;">
            {% if p.difficulty == "Easy" %}
              <span style="color:#2e7d32;font-weight:bold;">‚óè</span>
            {% elif p.difficulty == "Medium" %}
              <span style="color:#f57c00;font-weight:bold;">‚óè</span>
            {% elif p.difficulty == "Hard" %}
              <span style="color:#d32f2f;font-weight:bold;">‚óè</span>
            {% endif %}
            <span>{{ p.difficulty }}</span>
          </td>

          <td style="max-width:220px;">
            {% for t in p.tags.all %}
              <span style="
                background:#eef;
                border:1px solid #99c;
                border-radius:4px;
                padding:2px 6px;
                font-size:0.8rem;
                display:inline-block;
                margin:1px 2px;
              ">
                {{ t.name }}
              </span>
            {% empty %}
              <span style="color:#888;font-size:0.85rem;">‚Äî</span>
            {% endfor %}
          </td>

          <td style="white-space:nowrap;font-size:0.85rem;">
            {% with total=p.submission_count ac=p.ac_count %}
              {% if total > 0 %}
                <span style="font-weight:600;">{{ ac }}/{{ total }}</span>
                <span style="color:#555;">
                  ({{ p.success_rate }}%)
                </span>
              {% else %}
                <span style="color:#888;">0/0 (0%)</span>
              {% endif %}
            {% endwith %}
          </td>

          <td style="text-align:center;">
            {% if p.ai_supported %}
              <span title="AI Hint / AI Explain h·ªó tr·ª£"
                    style="display:inline-block;background:#222;color:#fff;font-size:0.7rem;
                           line-height:1;border-radius:4px;padding:3px 5px;font-family:monospace;">
                AI
              </span>
            {% else %}
              <span style="color:#bbb;font-size:0.7rem;">‚Äî</span>
            {% endif %}
          </td>

          <td style="text-align:right;white-space:nowrap;">
            <a href="{% url 'problem_detail' p.id %}"
               style="text-decoration:none;background:#1976d2;color:#fff;padding:6px 10px;
                      border-radius:4px;font-size:0.8rem;display:inline-block;">
              üìñ Xem
            </a>
            <a href="/submissions/{{ p.id }}/submit/"
               style="text-decoration:none;background:#2e7d32;color:#fff;padding:6px 10px;
                      border-radius:4px;font-size:0.8rem;display:inline-block;margin-left:4px;">
              üöÄ G·ª≠i b√†i
            </a>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="7" style="text-align:center;padding:24px;color:#888;">
            Kh√¥ng c√≥ b√†i to√°n n√†o ph√π h·ª£p.
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- G·ª£i √Ω UX h·ªçc sinh -->
  <div style="margin-top:16px;font-size:0.8rem;color:#666;">
    <b>G·ª£i √Ω:</b> Ch·ªçn b√†i Easy tr∆∞·ªõc ƒë·ªÉ l√†m quen. Nh·ªØng b√†i c√≥ nh√£n
    <span style="background:#222;color:#fff;font-size:0.7rem;line-height:1;border-radius:4px;padding:2px 4px;font-family:monospace;">AI</span>
    c√≥ th·ªÉ nh·∫≠n g·ª£i √Ω khi b·∫°n b·ªã WA.
  </div>
</div>
{% endblock %}
