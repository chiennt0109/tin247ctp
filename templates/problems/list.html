{% extends "base.html" %}
{% load static %}

{% block content %}

<div class="container mt-4">

  <h2 class="fw-bold mb-1">üß† Ng√¢n h√†ng b√†i t·∫≠p</h2>
  <p class="text-muted mb-4">Ch·ªçn b√†i ph√π h·ª£p v·ªõi tr√¨nh ƒë·ªô, ho·∫∑c b·∫Øt ƒë·∫ßu t·ª´ Easy ‚ú®</p>

  <!-- Filters -->
  <form method="get" class="row g-2 mb-3">
      <div class="col-md-3">
          <select name="tag" class="form-select rounded-pill">
              <option value="">üîñ T·∫•t c·∫£ ch·ªß ƒë·ªÅ</option>
              {% for tag in tags %}
              <option value="{{ tag.slug }}" {% if tag.slug == selected_tag %}selected{% endif %}>
                  {{ tag.name }}
              </option>
              {% endfor %}
          </select>
      </div>

      <div class="col-md-3">
          <select name="difficulty" class="form-select rounded-pill">
              <option value="">üéØ T·∫•t c·∫£ ƒë·ªô kh√≥</option>
              {% for d in difficulty_levels %}
              <option value="{{ d }}" {% if d == selected_difficulty %}selected{% endif %}>{{ d }}</option>
              {% endfor %}
          </select>
      </div>

      <div class="col-md-2 d-grid">
          <button class="btn btn-primary rounded-pill">L·ªçc</button>
      </div>
      <div class="col-md-2 d-grid">
          <a href="/problems/" class="btn btn-outline-secondary rounded-pill">Reset</a>
      </div>
  </form>

  <!-- ‚úÖ Datasheet Table -->
  <div class="card border-0 shadow-sm">
    <div class="table-responsive">
      <table class="table table-hover align-middle">
        <thead class="table-light">
          <tr>
            <th>M√£</th>
            <th>T√™n b√†i</th>
            <th>Tags</th>
            <th>ƒê·ªô kh√≥</th>
            <th>Ti·∫øn ƒë·ªô</th>
            <th class="text-center">Thao t√°c</th>
          </tr>
        </thead>
        <tbody>

        {% for p in problems %}
          <tr>
            <td class="fw-bold text-primary"><h5 class="fw-bold text-dark mb-1">
              <a href="{% url 'problem_detail' p.id %}" class="text-dark text-decoration-none hover-underline">{{ p.code }}</a></h5>
            </td>

            <td><h5 class="fw-bold text-dark mb-1">
              <a href="{% url 'problem_detail' p.id %}" class="text-dark text-decoration-none hover-underline">{{ p.title }}</a></h5>
            </td>

            <td>
              {% if p.tags.all %}
                {% for t in p.tags.all %}
                  <span class="badge bg-info-subtle text-info-emphasis rounded-pill">{{ t.name }}</span>
                {% endfor %}
              {% else %}
                <span class="text-muted">‚Äî</span>
              {% endif %}
            </td>

            <td>
              {% if p.difficulty == "Easy" %}
                <span class="badge bg-success-subtle text-success-emphasis rounded-pill">Easy</span>
              {% elif p.difficulty == "Medium" %}
                <span class="badge bg-warning-subtle text-warning-emphasis rounded-pill">Medium</span>
              {% else %}
                <span class="badge bg-danger-subtle text-danger-emphasis rounded-pill">Hard</span>
              {% endif %}
            </td>

            <td style="min-width:150px;">
              <div class="small text-muted">{{ p.ac_count }}/{{ p.submit_count }} ‚úÖ</div>
              <div class="progress" style="height:6px;">
                {% if p.submit_count > 0 %}
                  <div class="progress-bar bg-success" style="width: {{ p.ac_pct }}%"></div>
                {% else %}
                  <div class="progress-bar bg-secondary" style="width:0%"></div>
                {% endif %}
              </div>
            </td>

            <td class="text-center">
              <a href="{% url 'problem_detail' p.id %}" class="btn btn-outline-primary btn-sm rounded-pill">üëÅ Xem</a>
              <a href="{% url 'submission_create' p.id %}" class="btn btn-success btn-sm rounded-pill ms-1">üöÄ N·ªôp</a>
            </td>
          </tr>
        {% empty %}
          <tr><td colspan="6" class="text-center text-muted py-3">Kh√¥ng t√¨m th·∫•y b√†i n√†o</td></tr>
        {% endfor %}

        </tbody>
      </table>
    </div>
  </div>

  <!-- ‚úÖ Pagination -->
  {% if is_paginated %}
  <nav class="mt-3">
    <ul class="pagination justify-content-center">
      {% if page_obj.has_previous %}
      <li class="page-item">
        <a class="page-link" href="?page={{ page_obj.previous_page_number }}">&laquo;</a>
      </li>
      {% endif %}

      {% for num in paginator.page_range %}
      <li class="page-item {% if num == page_obj.number %}active{% endif %}">
        <a class="page-link" href="?page={{ num }}">{{ num }}</a>
      </li>
      {% endfor %}

      {% if page_obj.has_next %}
      <li class="page-item">
        <a class="page-link" href="?page={{ page_obj.next_page_number }}">&raquo;</a>
      </li>
      {% endif %}
    </ul>
  </nav>
  {% endif %}

</div>

<style>
.table-hover tbody tr:hover {
  background-color: #f8fafc !important;
}
.badge {
  font-size: 0.72rem;
}
</style>

{% endblock %}
