{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container py-4">

  <div class="mb-3">
      <h2 class="fw-bold">üß† Ng√¢n h√†ng b√†i t·∫≠p</h2>
      <p class="text-muted mb-1">H·ªçc theo t·ª´ng c·∫•p ƒë·ªô ‚Äî b·∫Øt ƒë·∫ßu t·ª´ d·ªÖ v√† ti·∫øn l√™n! üöÄ</p>
  </div>

  <!-- Filters -->
  <form method="get" class="row g-2 mb-3">
      <div class="col-md-3">
          <select name="tag" class="form-select rounded-pill shadow-sm">
              <option value="">üîñ Ch·ªß ƒë·ªÅ</option>
              {% for tag in tags %}
              <option value="{{ tag.slug }}" {% if tag.slug == selected_tag %}selected{% endif %}>{{ tag.name }}</option>
              {% endfor %}
          </select>
      </div>

      <div class="col-md-3">
          <select name="difficulty" class="form-select rounded-pill shadow-sm">
              <option value="">üéØ ƒê·ªô kh√≥</option>
              {% for d in difficulty_levels %}
              <option value="{{ d }}" {% if d == selected_difficulty %}selected{% endif %}>{{ d }}</option>
              {% endfor %}
          </select>
      </div>
      <div class="col-md-3">
          <input type="text" name="q" value="{{ search_query }}" placeholder="üîç T√¨m b√†i..." class="form-control rounded-pill shadow-sm">
      </div>
      
      <div class="col-md-2">
          <select name="sort" class="form-select rounded-pill shadow-sm">
              <option value="">‚öôÔ∏è S·∫Øp x·∫øp</option>
              <option value="difficulty" {% if sort_by == "difficulty" %}selected{% endif %}>Theo ƒë·ªô kh√≥</option>
              <option value="popularity" {% if sort_by == "popularity" %}selected{% endif %}>Theo ƒë·ªô ph·ªï bi·∫øn</option>
          </select>
      </div>

      <div class="col-md-2 d-grid">
          <button class="btn btn-primary rounded-pill shadow-sm">L·ªçc</button>
      </div>
      <div class="col-md-2 d-grid">
          <a href="/problems/" class="btn btn-outline-secondary rounded-pill shadow-sm">Reset</a>
      </div>
  </form>

  <!-- Problems List -->
  <div class="card border-0 shadow-sm rounded-4">
      <div class="table-responsive">
          <table class="table table-hover align-middle">
              <thead class="table-light">
                  <tr>
                      <th class="small">M√£</th>
                      <th class="small">T√™n b√†i</th>
                      <th class="small">Tags</th>
                      <th class="small">ƒê·ªô kh√≥</th>
                      <th class="small">Ti·∫øn ƒë·ªô</th>
                      <th class="small text-center" style="width:140px;">Thao t√°c</th>
                  </tr>
              </thead>
              <tbody>
              {% for p in problems %}
                  <tr>
                      <td class="fw-semibold text-primary">
                          <a href="{% url 'problem_detail' p.id %}" class="text-decoration-none">{{ p.code }}</a>
                      </td>

                      <td class="fw-semibold">
                          <a href="{% url 'problem_detail' p.id %}" class="text-dark text-decoration-none hover-underline">{{ p.title }}</a>
                      </td>

                      <td>
                          {% if p.tags.all %}
                            {% for t in p.tags.all %}
                              <span class="badge bg-light text-dark border rounded-pill">{{ t.name }}</span>
                            {% endfor %}
                          {% else %}
                            <span class="text-muted small">‚Äî</span>
                          {% endif %}
                      </td>

                      <td>
                          {% if p.difficulty == "Easy" %}
                            <span class="badge bg-success rounded-pill">Easy</span>
                          {% elif p.difficulty == "Medium" %}
                            <span class="badge bg-warning rounded-pill">Medium</span>
                          {% else %}
                            <span class="badge bg-danger rounded-pill">Hard</span>
                          {% endif %}
                      </td>

                      <td style="min-width:150px;">
                          {% widthratio p.ac_count p.submission_count 100 as pct %}
                          <div class="small text-muted">{{ p.ac_count }}/{{ p.submission_count }} ‚úÖ ({{ pct }}%)</div>
                          <div class="progress" style="height:5px;">
                              <div class="progress-bar bg-success" style="width: {{ pct }}%"></div>
                          </div>
                      </td>

                      <td class="text-center">
                          <a href="{% url 'problem_detail' p.id %}" class="btn btn-light btn-sm rounded-pill border">
                              üëÅ
                          </a>
                          <a href="{% url 'submission_create' p.id %}" class="btn btn-success btn-sm rounded-pill ms-1">
                              üöÄ
                          </a>
                      </td>
                  </tr>
              {% empty %}
                <tr><td colspan="6" class="text-center text-muted py-3">Kh√¥ng c√≥ b√†i n√†o</td></tr>
              {% endfor %}
              </tbody>
          </table>
      </div>
  </div>

  <!-- Pagination -->
  {% if problems.paginator.num_pages > 1 %}
  <nav class="mt-4">
    <ul class="pagination justify-content-center">

      {% if problems.has_previous %}
        <li class="page-item">
          <a class="page-link rounded-pill"
             href="?page={{ problems.previous_page_number }}&tag={{ selected_tag }}&difficulty={{ selected_difficulty }}">
             ‚¨Ö Tr∆∞·ªõc
          </a>
        </li>
      {% endif %}

      {% for i in problems.paginator.page_range %}
        <li class="page-item {% if problems.number == i %}active{% endif %}">
          <a class="page-link rounded-pill" href="?page={{ i }}&tag={{ problems.tag_param }}&difficulty={{ problems.diff_param }}"> {{ i }} </a>
        </li>
      {% endfor %}

      {% if problems.has_next %}
        <li class="page-item">
          <a class="page-link rounded-pill"
             href="?page={{ problems.next_page_number }}&tag={{ selected_tag }}&difficulty={{ selected_difficulty }}">
            Sau ‚û°
          </a>
        </li>
      {% endif %}
    </ul>
  </nav>
  {% endif %}
</div>

<style>
.table-hover tbody tr:hover { background-color:#f8fafc !important; }
.hover-underline:hover { text-decoration: underline!important; }
.card { border-radius: 14px!important; }
</style>

{% endblock %}
