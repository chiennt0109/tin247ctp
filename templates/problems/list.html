{% extends "base.html" %}
{% load static %}

{% block content %}

<div class="container mt-4">

  <h2 class="fw-bold mb-1">üß† Ng√¢n h√†ng b√†i t·∫≠p</h2>
  <p class="text-muted mb-4">Ch·ªçn b√†i ph√π h·ª£p v·ªõi tr√¨nh ƒë·ªô, ho·∫∑c b·∫Øt ƒë·∫ßu t·ª´ Easy ‚ú®</p>

  <!-- Filters -->
  <form method="get" class="row g-2 mb-3">
      <div class="col-md-3">
          <select name="tag" class="form-select rounded-pill">
              <option value="">üîñ T·∫•t c·∫£ ch·ªß ƒë·ªÅ</option>
              {% for tag in tags %}
              <option value="{{ tag.slug }}" {% if tag.slug == selected_tag %}selected{% endif %}>
                  {{ tag.name }}
              </option>
              {% endfor %}
          </select>
      </div>

      <div class="col-md-3">
          <select name="difficulty" class="form-select rounded-pill">
              <option value="">üéØ T·∫•t c·∫£ ƒë·ªô kh√≥</option>
              {% for d in difficulty_levels %}
              <option value="{{ d }}" {% if d == selected_difficulty %}selected{% endif %}>{{ d }}</option>
              {% endfor %}
          </select>
      </div>

      <div class="col-md-2 d-grid">
          <button class="btn btn-primary rounded-pill">L·ªçc</button>
      </div>
      <div class="col-md-2 d-grid">
          <a href="/problems/" class="btn btn-outline-secondary rounded-pill">Reset</a>
      </div>
  </form>

  <!-- ‚úÖ Datasheet Table -->
  <div class="card border-0 shadow-sm">
    <div class="table-responsive">
      <table class="table table-hover align-middle">
        <thead class="table-light">
          <tr>
            <th>M√£</th>
            <th>T√™n b√†i</th>
            <th>Tags</th>
            <th>ƒê·ªô kh√≥</th>
            <th>Ti·∫øn ƒë·ªô</th>
            <th class="text-center">Thao t√°c</th>
          </tr>
        </thead>
        <tbody>

        {% for p in problems %}
          <tr>
            <td class="fw-bold">
              <h5 class="fw-bold mb-1">
                <a href="{% url 'problem_detail' p.id %}" class="text-dark text-decoration-none hover-underline">
                  {{ p.code }}
                </a>
              </h5>
            </td>

            <td>
              <h5 class="fw-bold mb-1">
                <a href="{% url 'problem_detail' p.id %}" class="text-dark text-decoration-none hover-underline">
                  {{ p.title }}
                </a>
              </h5>
            </td>

            <td>
              {% if p.tags.all|length %}
                {% for t in p.tags.all %}
                  <span class="badge bg-info-subtle text-info-emphasis rounded-pill">{{ t.name }}</span>
                {% endfor %}
              {% else %}
                <span class="text-muted">‚Äî</span>
              {% endif %}
            </td>

            <td>
              {% if p.difficulty == "Easy" %}
                <span class="badge bg-success-subtle text-success-emphasis rounded-pill">Easy</span>
              {% elif p.difficulty == "Medium" %}
                <span class="badge bg-warning-subtle text-warning-emphasis rounded-pill">Medium</span>
              {% else %}
                <span class="badge bg-danger-subtle text-danger-emphasis rounded-pill">Hard</span>
              {% endif %}
            </td>

            <td style="min-width:180px;">
              {% if p.submission_count and p.submission_count > 0 %}
                {% widthratio p.ac_count p.submission_count 100 as ac_pct %}
                <div class="small text-muted">{{ p.ac_count }}/{{ p.submission_count }} ‚úÖ ({{ ac_pct }}%)</div>
                <div class="progress" style="height:6px;">
                  <div class="progress-bar bg-success" style="width: {{ ac_pct }}%"></div>
                </div>
              {% else %}
                <div class="small text-muted">‚è≥ No submissions yet</div>
                <div class="progress" style="height:6px;">
                  <div class="progress-bar bg-secondary" style="width:0%"></div>
                </div>
              {% endif %}
            </td>

            <td class="text-center">
              <a href="{% url 'problem_detail' p.id %}" class="btn btn-outline-primary btn-sm rounded-pill">üëÅ Xem</a>
              <a href="{% url 'submission_create' p.id %}" class="btn btn-success btn-sm rounded-pill ms-1">üöÄ N·ªôp</a>
            </td>
          </tr>
        {% empty %}
          <tr><td colspan="6" class="text-center text-muted py-3">Kh√¥ng t√¨m th·∫•y b√†i n√†o</td></tr>
        {% endfor %}

        </tbody>
      </table>
    </div>
  </div>

  <!-- ‚úÖ Pagination: gi·ªØ b·ªô l·ªçc khi chuy·ªÉn trang -->
  <nav>
    <ul class="pagination justify-content-center mt-4">

      {% if problems.has_previous %}
      <li class="page-item">
        <a class="page-link rounded-pill"
           href="?page={{ problems.previous_page_number }}{% if selected_tag %}&tag={{ selected_tag }}{% endif %}{% if selected_difficulty %}&difficulty={{ selected_difficulty }}{% endif %}">
           ‚¨Ö Tr∆∞·ªõc
        </a>
      </li>
      {% endif %}

      {% for i in problems.paginator.page_range %}
      <li class="page-item {% if problems.number == i %}active{% endif %}">
        <a class="page-link rounded-pill"
           href="?page={{ i }}{% if selected_tag %}&tag={{ selected_tag }}{% endif %}{% if selected_difficulty %}&difficulty={{ selected_difficulty }}{% endif %}">
           {{ i }}
        </a>
      </li>
      {% endfor %}

      {% if problems.has_next %}
      <li class="page-item">
        <a class="page-link rounded-pill"
           href="?page={{ problems.next_page_number }}{% if selected_tag %}&tag={{ selected_tag }}{% endif %}{% if selected_difficulty %}&difficulty={{ selected_difficulty }}{% endif %}">
           Sau ‚û°
        </a>
      </li>
      {% endif %}

    </ul>
  </nav>

</div>

<style>
.table-hover tbody tr:hover { background-color: #f8fafc !important; }
.badge { font-size: 0.72rem; }
.hover-underline:hover { text-decoration: underline !important; }
</style>

{% endblock %}
